<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - Test Update Settings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body {
            padding: 40px;
            background: #f8f9fa;
        }
        .demo-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .demo-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2176FF;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-section h6 {
            font-weight: 600;
            margin-bottom: 12px;
        }
        .step {
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .step-number {
            width: 32px;
            height: 32px;
            background: #2176FF;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }
        .step-text {
            flex: 1;
        }
        .check-item {
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        .status-ok {
            background: #10b981;
            color: white;
        }
        .status-error {
            background: #ef4444;
            color: white;
        }
        .data-preview {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="demo-card">
            <h1 class="demo-title">
                <i class="bi bi-gear-fill me-2"></i>
                Demo - Test Chức Năng Cập Nhật Cài Đặt
            </h1>

            <!-- Instructions -->
            <div class="test-section">
                <h6><i class="bi bi-list-check me-2"></i>Hướng dẫn test từng bước:</h6>
                
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-text">
                        <strong>Đăng nhập tài khoản</strong><br>
                        <small class="text-muted">Sử dụng email: admin@example.com | Password: 12345678</small>
                    </div>
                    <button class="btn btn-sm btn-primary" onclick="quickLogin()">Đăng nhập nhanh</button>
                </div>

                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-text">
                        <strong>Mở trang cài đặt</strong><br>
                        <small class="text-muted">Nhấn nút bên dưới hoặc vào sidebar → Cài đặt</small>
                    </div>
                    <button class="btn btn-sm btn-success" onclick="window.location.href='Trang-cai-dat.html'">
                        <i class="bi bi-arrow-right-circle me-1"></i>Mở trang cài đặt
                    </button>
                </div>

                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-text">
                        <strong>Test Tab "Thông tin tài khoản"</strong><br>
                        <small class="text-muted">Thay đổi Họ tên, SĐT, Email liên hệ → Nhấn "Cập nhật"</small>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-text">
                        <strong>Test Tab "Thông tin công ty"</strong><br>
                        <small class="text-muted">Nhập Mã số thuế, Tên công ty, chọn Quy mô, Địa điểm → Nhấn "Cập nhật"</small>
                    </div>
                </div>

                <div class="step">
                    <div class="step-number">5</div>
                    <div class="step-text">
                        <strong>Kiểm tra dữ liệu đã lưu</strong><br>
                        <small class="text-muted">Xem bên dưới để thấy dữ liệu trong localStorage</small>
                    </div>
                    <button class="btn btn-sm btn-info" onclick="loadData()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Refresh dữ liệu
                    </button>
                </div>
            </div>

            <!-- Status Check -->
            <div class="test-section">
                <h6><i class="bi bi-clipboard-check me-2"></i>Kiểm tra trạng thái hệ thống:</h6>
                
                <div class="check-item" id="checkLogin">
                    <div class="status-icon status-error"><i class="bi bi-x"></i></div>
                    <span>Đã đăng nhập</span>
                </div>

                <div class="check-item" id="checkUserData">
                    <div class="status-icon status-error"><i class="bi bi-x"></i></div>
                    <span>Có dữ liệu người dùng</span>
                </div>

                <div class="check-item" id="checkCompanyData">
                    <div class="status-icon status-error"><i class="bi bi-x"></i></div>
                    <span>Có thông tin công ty</span>
                </div>

                <div class="check-item" id="checkComplete">
                    <div class="status-icon status-error"><i class="bi bi-x"></i></div>
                    <span>Hồ sơ hoàn chỉnh</span>
                </div>
            </div>

            <!-- Data Preview -->
            <div class="test-section">
                <h6><i class="bi bi-database me-2"></i>Dữ liệu trong localStorage:</h6>
                <div class="data-preview" id="dataPreview">
                    Loading...
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-primary" onclick="quickLogin()">
                    <i class="bi bi-box-arrow-in-right me-2"></i>Đăng nhập nhanh
                </button>
                <button class="btn btn-success" onclick="window.location.href='Trang-cai-dat.html'">
                    <i class="bi bi-gear-fill me-2"></i>Mở trang cài đặt
                </button>
                <button class="btn btn-info" onclick="loadData()">
                    <i class="bi bi-arrow-clockwise me-2"></i>Refresh
                </button>
                <button class="btn btn-warning" onclick="logout()">
                    <i class="bi bi-box-arrow-left me-2"></i>Đăng xuất
                </button>
                <button class="btn btn-danger" onclick="clearData()">
                    <i class="bi bi-trash me-2"></i>Xóa dữ liệu
                </button>
            </div>
        </div>
    </div>

    <script>
        function quickLogin() {
            const currentUser = {
                id: 1,
                email: 'admin@example.com',
                phone: '0123456789',
                loginTime: new Date().toISOString()
            };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            alert('✅ Đã đăng nhập với tài khoản admin@example.com');
            loadData();
        }

        function logout() {
            localStorage.removeItem('currentUser');
            alert('✅ Đã đăng xuất');
            loadData();
        }

        function clearData() {
            if (confirm('Xóa tất cả dữ liệu?')) {
                localStorage.clear();
                alert('✅ Đã xóa tất cả dữ liệu');
                loadData();
            }
        }

        function loadData() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('users')) || [];
            
            let userData = null;
            if (currentUser) {
                userData = users.find(u => u.id === currentUser.id);
            }

            // Update status checks
            updateCheck('checkLogin', !!currentUser);
            updateCheck('checkUserData', !!userData);
            updateCheck('checkCompanyData', userData && userData.companyData);
            updateCheck('checkComplete', userData && userData.companyData && userData.companyData.taxCode);

            // Display data
            const dataPreview = document.getElementById('dataPreview');
            
            if (!currentUser) {
                dataPreview.innerHTML = '<span style="color: #fbbf24;">⚠ Chưa đăng nhập. Nhấn "Đăng nhập nhanh" để test.</span>';
            } else if (!userData) {
                dataPreview.innerHTML = '<span style="color: #f87171;">❌ Không tìm thấy dữ liệu người dùng</span>';
            } else {
                dataPreview.innerHTML = `
<span style="color: #86efac;">// ✅ Người dùng hiện tại</span>
<span style="color: #60a5fa;">currentUser</span> = ${JSON.stringify(currentUser, null, 2)}

<span style="color: #86efac;">// ✅ Dữ liệu đầy đủ</span>
<span style="color: #60a5fa;">userData</span> = {
  <span style="color: #fbbf24;">id</span>: ${userData.id},
  <span style="color: #fbbf24;">fullName</span>: "${userData.fullName || ''}",
  <span style="color: #fbbf24;">email</span>: "${userData.email || ''}",
  <span style="color: #fbbf24;">phone</span>: "${userData.phone || ''}",
  <span style="color: #fbbf24;">companyName</span>: "${userData.companyName || ''}",
  <span style="color: #fbbf24;">companySize</span>: "${userData.companySize || ''}",
  
  <span style="color: #86efac;">// Thông tin công ty chi tiết</span>
  <span style="color: #fbbf24;">companyData</span>: {
    <span style="color: #fbbf24;">taxCode</span>: "${userData.companyData?.taxCode || ''}",
    <span style="color: #fbbf24;">name</span>: "${userData.companyData?.name || ''}",
    <span style="color: #fbbf24;">size</span>: "${userData.companyData?.size || ''}",
    <span style="color: #fbbf24;">location</span>: "${userData.companyData?.location || ''}",
    <span style="color: #fbbf24;">address</span>: "${userData.companyData?.address || ''}",
    <span style="color: #fbbf24;">phone</span>: "${userData.companyData?.phone || ''}",
    <span style="color: #fbbf24;">industries</span>: [${userData.companyData?.industries?.map(i => `"${i}"`).join(', ') || ''}]
  },
  
  <span style="color: #fbbf24;">contactEmail</span>: "${userData.contactEmail || ''}",
  <span style="color: #fbbf24;">address</span>: "${userData.address || ''}",
  <span style="color: #fbbf24;">loginAlert</span>: ${userData.loginAlert || false},
  <span style="color: #fbbf24;">avatar</span>: "${userData.avatar ? '(có ảnh)' : '(chưa có)'}"
}
                `.trim();
            }
        }

        function updateCheck(id, isOk) {
            const el = document.getElementById(id);
            const icon = el.querySelector('.status-icon');
            
            if (isOk) {
                icon.className = 'status-icon status-ok';
                icon.innerHTML = '<i class="bi bi-check"></i>';
            } else {
                icon.className = 'status-icon status-error';
                icon.innerHTML = '<i class="bi bi-x"></i>';
            }
        }

        // Auto refresh
        setInterval(loadData, 3000);
        loadData();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
